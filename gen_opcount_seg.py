import subprocess
import timeit
import resource

start_time = timeit.default_timer()
data_path='.'
opcode_path='op_train'
jump_path='jump_train'
jump_map_path='jump_map_train'

cmd='mkdir '+' '.join([opcode_path,jump_path,jump_map_path]) #make directories op_train jump_train jump_map_train
print cmd
subprocess.call(cmd,shell=True)

cmd='python get_ins.py xid_train.p '+' '.join([data_path+'/train',opcode_path])
print cmd
subprocess.call(cmd,shell=True)

cmd='python get_jump.py xid_train.p '+' '.join([opcode_path,jump_path])
print cmd
subprocess.call(cmd,shell=True)
	
cmd='python get_jump_map.py xid_train.p '+' '.join([data_path+'/train',jump_path,jump_map_path])
print cmd
subprocess.call(cmd,shell=True)

cmd='python find_new_ins.py xid_train.p '+' '.join([opcode_path,jump_map_path])
print cmd
subprocess.call(cmd,shell=True)

cmd='python filtcmd.py'
print cmd
subprocess.call(cmd,shell=True)

cmd='python find_2g.py xid_train.p '+data_path+'/train'
print cmd
subprocess.call(cmd,shell=True)

cmd='python find_3g.py xid_train.p '+data_path+'/train'
print cmd
subprocess.call(cmd,shell=True)

cmd='python cut3g.py'
print cmd
subprocess.call(cmd,shell=True)

cmd='python cut3g_for_4g.py'
print cmd
subprocess.call(cmd,shell=True)

cmd='python find_4g.py xid_train.p '+data_path+'/train'
print cmd
subprocess.call(cmd,shell=True)

cmd='python cut4g.py'
print cmd
subprocess.call(cmd,shell=True)

cmd='python findhead.py xid_train.p '+data_path+'/train'
print cmd
subprocess.call(cmd,shell=True)

cmd='python rebuild_2g3g4ghead.py xid_train.p '+data_path+'/train'
print cmd
subprocess.call(cmd,shell=True)



cmd='python rebuild_2g3g4ghead.py xid_test.p '+data_path+'/test'
print cmd
subprocess.call(cmd,shell=True


cmd='python getfea.py'
print cmd
subprocess.call(cmd,shell=True)
elapsed = str(int(timeit.default_timer() - start_time))

ram = str(resource.getrusage(resource.RUSAGE_SELF).ru_maxrss / 1000)
op = str('\n' + '***************** For OPCount  ****************** ' + '\n' +'Total Time ' + elapsed + ' RAM ' + ram)
with open('Log.txt', 'a') as file:
	file.write(op)
	file.write("\n")
print "DONE!"
